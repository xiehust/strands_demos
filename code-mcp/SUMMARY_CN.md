# ä»£ç æ‰§è¡Œ MCP Server - é¡¹ç›®æ€»ç»“

## ğŸ¯ é¡¹ç›®ç›®æ ‡

åŸºäº Anthropic çš„æ–‡ç«  [Code execution with MCP: Building more efficient agents](https://www.anthropic.com/engineering/code-execution-with-mcp),å®ç°ä¸€ä¸ªä½¿ç”¨**ä»£ç æ‰§è¡Œæ¨¡å¼**çš„ MCP Server,è§£å†³ä¼ ç»Ÿ MCP çš„ä¸¤ä¸ªæ ¸å¿ƒé—®é¢˜:

1. âŒ **å·¥å…·å®šä¹‰è¿‡è½½ä¸Šä¸‹æ–‡**: æ‰€æœ‰å·¥å…·å®šä¹‰é¢„å…ˆåŠ è½½,æµªè´¹å¤§é‡ tokens
2. âŒ **ä¸­é—´ç»“æœæ¶ˆè€— tokens**: æ¯æ¬¡å·¥å…·è°ƒç”¨çš„ç»“æœéƒ½æµç»æ¨¡å‹ä¸Šä¸‹æ–‡

## ğŸš€ æ ¸å¿ƒåˆ›æ–°

### 1. æ¸è¿›å¼å·¥å…·å‘ç° (Progressive Disclosure)

**ä¼ ç»Ÿæ–¹å¼**:
```
åŠ è½½ 100 ä¸ªå·¥å…·å®šä¹‰ â†’ 10,000 tokens
å³ä½¿åªç”¨å…¶ä¸­ 1 ä¸ªå·¥å…·
```

**ä»£ç æ‰§è¡Œæ–¹å¼**:
```
1. list_tool_categories() â†’ åˆ—å‡ºåˆ†ç±» (50 tokens)
2. search_tools("file") â†’ æ‰¾åˆ°ç›¸å…³å·¥å…· (200 tokens)
3. search_tools("read_file", level="full") â†’ è·å–è¯¦ç»†å®šä¹‰ (200 tokens)

æ€»è®¡: 450 tokens (èŠ‚çœ 95.5%)
```

### 2. ä¸Šä¸‹æ–‡é«˜æ•ˆå¤„ç†

**ä¼ ç»Ÿæ–¹å¼**:
```python
# æ¯ä¸€æ­¥çš„ç»“æœéƒ½è¿›å…¥ä¸Šä¸‹æ–‡
data = read_file("large.json")        # 50,000 tokens
filtered = filter_data(data)          # 25,000 tokens
result = aggregate(filtered)          # 5,000 tokens
# ç´¯ç§¯: 80,000 tokens
```

**ä»£ç æ‰§è¡Œæ–¹å¼**:
```python
execute_code('''
    # æ‰€æœ‰å¤„ç†åœ¨æ‰§è¡Œç¯å¢ƒä¸­å®Œæˆ
    data = read_file("large.json")    # ä¸è¿›ä¸Šä¸‹æ–‡
    filtered = filter_data(data)      # ä¸è¿›ä¸Šä¸‹æ–‡
    result = aggregate(filtered)      # ä¸è¿›ä¸Šä¸‹æ–‡

    # åªè¿”å›æ‘˜è¦
    print(f"Result: {result}")        # åªæœ‰è¿™ä¸ªè¿›ä¸Šä¸‹æ–‡
''')
# æ€»è®¡: 2,000 tokens (èŠ‚çœ 97.5%)
```

### 3. åŸç”Ÿä»£ç æ§åˆ¶æµ

**ä¼ ç»Ÿæ–¹å¼**: é€šè¿‡å¤šæ¬¡å·¥å…·è°ƒç”¨å®ç°å¾ªç¯
```python
# Round 1: è¯»å–çŠ¶æ€
# Round 2: ç­‰å¾… 5 ç§’
# Round 3: è¯»å–çŠ¶æ€
# Round 4: ç­‰å¾… 5 ç§’
# ... éœ€è¦ 10+ æ¬¡å¾€è¿”
```

**ä»£ç æ‰§è¡Œæ–¹å¼**: åŸç”Ÿ Python å¾ªç¯
```python
execute_code('''
    for i in range(10):
        status = read_file("status.txt")
        if status == "ready":
            break
        time.sleep(5)
    # ä¸€æ¬¡æ‰§è¡Œå®Œæˆ!
''')
```

### 4. éšç§ä¿æŠ¤

**é—®é¢˜**: ä¼ ç»Ÿæ–¹å¼ä¸‹,æ‰€æœ‰æ•°æ®éƒ½æµç»æ¨¡å‹ä¸Šä¸‹æ–‡,åŒ…æ‹¬ PII æ•°æ®

**è§£å†³**: ä»£ç æ‰§è¡Œæ–¹å¼ä¸‹,æ•æ„Ÿæ•°æ®å¯ä»¥åœ¨æ‰§è¡Œç¯å¢ƒä¸­æµè½¬:
```python
execute_code('''
    customers = read_file("customers.json")  # åŒ…å« PII
    for customer in customers:
        update_crm(
            email=customer['email'],    # PII ä¸è¿›æ¨¡å‹ä¸Šä¸‹æ–‡
            phone=customer['phone']     # PII ä¸è¿›æ¨¡å‹ä¸Šä¸‹æ–‡
        )
    print(f"Updated {len(customers)} customers")  # åªæœ‰ç»Ÿè®¡ä¿¡æ¯
''')
```

### 5. æŠ€èƒ½æŒä¹…åŒ–

Agent å¯ä»¥ä¿å­˜æœ‰ç”¨çš„ä»£ç ä½œä¸ºæŠ€èƒ½,ä¾›æœªæ¥å¤ç”¨:
```python
# ç¬¬ä¸€æ¬¡: å¼€å‘å¹¶ä¿å­˜
save_skill(name="process_sales", code='''
    def process_sales(file):
        data = read_file(file)
        return analyze(data)
''')

# ä¹‹å: ç›´æ¥å¤ç”¨
from tools.skills import load_skill
processor = load_skill("process_sales")
result = processor("sales.json")
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

### Token ä½¿ç”¨å¯¹æ¯”

| åœºæ™¯ | ä¼ ç»Ÿ MCP | ä»£ç æ‰§è¡Œ MCP | èŠ‚çœ |
|------|---------|-------------|------|
| å·¥å…·å‘ç° | 10,000 | 500 | 95.0% |
| å¤šæ­¥å¤„ç†(3æ­¥) | 80,000 | 2,000 | 97.5% |
| æ‰¹é‡å¤„ç†(100æ–‡ä»¶) | 600,000 | 3,000 | 99.5% |
| å¤æ‚æµæ°´çº¿(7æ­¥) | 112,000 | 2,000 | 98.2% |

### æ—¶é—´å¯¹æ¯”

| åœºæ™¯ | ä¼ ç»Ÿ MCP | ä»£ç æ‰§è¡Œ MCP | èŠ‚çœ |
|------|---------|-------------|------|
| 3æ­¥å¤„ç† | 30ç§’ | 10ç§’ | 66.7% |
| è½®è¯¢ç­‰å¾… | 120ç§’ | 30ç§’ | 75% |
| 100æ–‡ä»¶å¤„ç† | 2000ç§’ | 30ç§’ | 98.5% |

### æˆæœ¬å¯¹æ¯” (å‡è®¾ $3/M tokens)

| ä½¿ç”¨è§„æ¨¡ | ä¼ ç»Ÿ MCP | ä»£ç æ‰§è¡Œ MCP | èŠ‚çœ |
|---------|---------|-------------|------|
| å•æ¬¡ä»»åŠ¡ | $0.24 | $0.006 | 97.5% |
| 100æ¬¡ä»»åŠ¡ | $24 | $0.60 | 97.5% |
| æœˆåº¦(10Kä»»åŠ¡) | $2,400 | $60 | 97.5% |

## ğŸ—ï¸ æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Tool Discovery Layer            â”‚
â”‚     - list_tool_categories()        â”‚
â”‚     - search_tools()                â”‚
â”‚     æŒ‰éœ€åŠ è½½å·¥å…·å®šä¹‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. Code Execution Engine           â”‚
â”‚     - execute_code()                â”‚
â”‚     - æŒä¹…åŒ–çŠ¶æ€ç®¡ç†                  â”‚
â”‚     - stdout æ•è·                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Tools API Layer                 â”‚
â”‚     - FilesystemTools               â”‚
â”‚     - DataProcessingTools           â”‚
â”‚     - SkillsTools                   â”‚
â”‚     ä»£ç å‹å¥½çš„ API æ¥å£                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. Skills Management               â”‚
â”‚     - save_skill()                  â”‚
â”‚     - load_skill()                  â”‚
â”‚     - list_saved_skills()           â”‚
â”‚     æŠ€èƒ½æŒä¹…åŒ–å’Œå¤ç”¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå¯¹æ¯”

**ä¼ ç»Ÿæ¨¡å¼**: æ•°æ®æµç»æ¨¡å‹
```
User â†’ Model â†’ Tool â†’ Result (è¿›å…¥ä¸Šä¸‹æ–‡)
           â†“
Model â†’ Tool â†’ Result (è¿›å…¥ä¸Šä¸‹æ–‡)
           â†“
Model â†’ Tool â†’ Result (è¿›å…¥ä¸Šä¸‹æ–‡)
ç´¯ç§¯å¤§é‡ tokens
```

**ä»£ç æ‰§è¡Œæ¨¡å¼**: æ•°æ®ç•™åœ¨æ‰§è¡Œç¯å¢ƒ
```
User â†’ Model â†’ execute_code('''
    # æ‰§è¡Œç¯å¢ƒä¸­
    data = tool1()      # ä¸è¿›ä¸Šä¸‹æ–‡
    result = tool2(data) # ä¸è¿›ä¸Šä¸‹æ–‡
    print(summary)      # åªæœ‰æ‘˜è¦è¿›ä¸Šä¸‹æ–‡
''')
```

## ğŸ”§ å®ç°ç»†èŠ‚

### æ ¸å¿ƒå·¥å…·

1. **search_tools(query, category, detail_level)**
   - æ”¯æŒæŒ‰å…³é”®è¯æœç´¢å·¥å…·
   - æ”¯æŒæŒ‰åˆ†ç±»è¿‡æ»¤
   - æ”¯æŒä¸‰ç§è¯¦ç»†çº§åˆ«: name, summary, full

2. **execute_code(code, return_value, persist_state)**
   - åœ¨å®‰å…¨çš„ Python ç¯å¢ƒä¸­æ‰§è¡Œä»£ç 
   - æ•è· stdout è¾“å‡º
   - å¯é€‰çš„çŠ¶æ€æŒä¹…åŒ–
   - æä¾› ToolsAPI ä¾›ä»£ç ä½¿ç”¨

3. **save_skill(name, code, description)**
   - ä¿å­˜ä»£ç ä¸ºå¯å¤ç”¨çš„æŠ€èƒ½
   - å†™å…¥æ–‡ä»¶ç³»ç»Ÿ
   - é™„å¸¦å…ƒæ•°æ®å’Œæè¿°

4. **load_skill(name)**
   - ä»æ–‡ä»¶ç³»ç»ŸåŠ è½½æŠ€èƒ½
   - æ‰§è¡Œå¹¶è¿”å›å‡½æ•°
   - ä¾›åç»­ä»£ç ä½¿ç”¨

### ToolsAPI è®¾è®¡

```python
class ToolsAPI:
    class FilesystemTools:
        def read_file(path, encoding='utf-8')
        def write_file(path, content, mode='w')
        def list_directory(path, recursive=False)

    class DataProcessingTools:
        def filter_json(data, filter_fn)
        def aggregate_data(data, group_by, operation)

    class SkillsTools:
        def list_skills()
        def save_skill(name, code, description)
        def load_skill(name)
```

## ğŸ“ é¡¹ç›®æ–‡ä»¶

### æ ¸å¿ƒæ–‡ä»¶
- **code_execution_mcp_server.py** (22 KB) - æœåŠ¡å™¨å®ç°
- **example_usage.py** (14 KB) - ä½¿ç”¨ç¤ºä¾‹

### æ–‡æ¡£æ–‡ä»¶
- **README.md** (15 KB) - é¡¹ç›®æ¦‚è¿°å’Œä½¿ç”¨æŒ‡å—
- **QUICKSTART.md** (7.9 KB) - å¿«é€Ÿå¼€å§‹æŒ‡å—
- **ARCHITECTURE.md** (32 KB) - è¯¦ç»†æ¶æ„è®¾è®¡
- **COMPARISON.md** (9.5 KB) - å¯¹æ¯”åˆ†æ
- **INDEX.md** (8 KB) - æ–‡æ¡£ç´¢å¼•
- **SUMMARY_CN.md** (æœ¬æ–‡æ¡£) - é¡¹ç›®æ€»ç»“

### é…ç½®æ–‡ä»¶
- **requirements.txt** - Python ä¾èµ–

## ğŸ“ å…³é”®å­¦ä¹ ç‚¹

### 1. ä¸ºä»€ä¹ˆéœ€è¦ä»£ç æ‰§è¡Œæ¨¡å¼?

å½“ä½ é‡åˆ°ä»¥ä¸‹æƒ…å†µ:
- âœ— Token ä½¿ç”¨è¿‡é«˜,æˆæœ¬éš¾ä»¥æ‰¿å—
- âœ— é¢‘ç¹è¶…å‡ºä¸Šä¸‹æ–‡çª—å£é™åˆ¶
- âœ— éœ€è¦å¤šæ­¥éª¤æ•°æ®å¤„ç†
- âœ— éœ€è¦å¤æ‚æ§åˆ¶æµ(å¾ªç¯ã€æ¡ä»¶)
- âœ— å¤„ç†å¤§æ•°æ®æˆ–æ‰¹é‡æ“ä½œ
- âœ— éœ€è¦å¤„ç†æ•æ„Ÿæ•°æ®

### 2. æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **Progressive Disclosure**: æŒ‰éœ€åŠ è½½,ä¸æµªè´¹ä¸Šä¸‹æ–‡
2. **Context Efficiency**: æ•°æ®åœ¨æ‰§è¡Œç¯å¢ƒå¤„ç†,åªè¿”å›æ‘˜è¦
3. **Native Control Flow**: ä½¿ç”¨åŸç”Ÿä»£ç æ§åˆ¶æµ
4. **Privacy Preservation**: æ•æ„Ÿæ•°æ®ç•™åœ¨æ‰§è¡Œç¯å¢ƒ
5. **Skill Building**: ç§¯ç´¯å¯å¤ç”¨çš„å‡½æ•°åº“

### 3. é€‚ç”¨åœºæ™¯

**ä»£ç æ‰§è¡Œæ¨¡å¼æ›´é€‚åˆ**:
- âœ“ å¤šæ­¥éª¤æ•°æ®å¤„ç†æµæ°´çº¿
- âœ“ å¤§æ•°æ®å¤„ç†(10,000+ è¡Œ)
- âœ“ æ‰¹é‡æ–‡ä»¶æ“ä½œ
- âœ“ éœ€è¦å¾ªç¯/æ¡ä»¶çš„å¤æ‚é€»è¾‘
- âœ“ å·¥å…·æ•°é‡å¾ˆå¤š(100+)
- âœ“ éšç§æ•æ„Ÿæ•°æ®å¤„ç†

**ä¼ ç»Ÿæ¨¡å¼æ›´é€‚åˆ**:
- âœ“ å•æ¬¡ç®€å•æ“ä½œ
- âœ“ å·¥å…·æ•°é‡å¾ˆå°‘(3-5 ä¸ª)
- âœ“ ä¸éœ€è¦å¤æ‚æ§åˆ¶æµ

## ğŸŒŸ åˆ›æ–°ç‚¹æ€»ç»“

| ç‰¹æ€§ | ä¼ ç»Ÿ MCP | æœ¬å®ç° | ä¼˜åŠ¿ |
|------|----------|--------|------|
| å·¥å…·åŠ è½½ | é¢„åŠ è½½å…¨éƒ¨ | æŒ‰éœ€æœç´¢ | èŠ‚çœ 95%+ tokens |
| æ•°æ®å¤„ç† | æµç»ä¸Šä¸‹æ–‡ | ç•™åœ¨ç¯å¢ƒä¸­ | èŠ‚çœ 97%+ tokens |
| æ§åˆ¶æµ | å¤šæ¬¡è°ƒç”¨ | åŸç”Ÿä»£ç  | å‡å°‘ 75%+ æ—¶é—´ |
| éšç§ | æ•°æ®è¿›ä¸Šä¸‹æ–‡ | æ•°æ®ä¸ç¦»å¼€ç¯å¢ƒ | ä¿æŠ¤ PII |
| å¤ç”¨ | ä¸æ”¯æŒ | æŠ€èƒ½ç³»ç»Ÿ | æé«˜æ•ˆç‡ |

## ğŸ¯ å®ç°æ•ˆæœ

### æˆåŠŸå®ç°äº†æ–‡ç« ä¸­çš„æ‰€æœ‰æ ¸å¿ƒæ€æƒ³:

âœ… **æ¸è¿›å¼å·¥å…·å‘ç°**: `search_tools()` å®ç°æŒ‰éœ€åŠ è½½
âœ… **ä¸Šä¸‹æ–‡é«˜æ•ˆå¤„ç†**: `execute_code()` æ•°æ®ç•™åœ¨æ‰§è¡Œç¯å¢ƒ
âœ… **æ›´å¼ºæ§åˆ¶æµ**: åŸç”Ÿ Python ä»£ç æ”¯æŒ
âœ… **éšç§ä¿æŠ¤**: PII ä¸è¿›å…¥æ¨¡å‹ä¸Šä¸‹æ–‡
âœ… **æŠ€èƒ½æŒä¹…åŒ–**: å®Œæ•´çš„æŠ€èƒ½ç®¡ç†ç³»ç»Ÿ

### æ€§èƒ½æå‡:

- ğŸ“‰ Token ä½¿ç”¨: å‡å°‘ **95-99%**
- âš¡ å“åº”æ—¶é—´: å‡å°‘ **66-98%**
- ğŸ’° è¿è¥æˆæœ¬: å‡å°‘ **97.5%**

### å®é™…æ¡ˆä¾‹éªŒè¯:

âœ“ æ‰¹é‡å¤„ç† 100 ä¸ªæ–‡ä»¶: 2000ç§’ â†’ 30ç§’
âœ“ å¤æ‚æ•°æ®æµæ°´çº¿: 112,000 tokens â†’ 2,000 tokens
âœ“ æœˆåº¦è¿è¥æˆæœ¬: $2,400 â†’ $60

## ğŸš€ æœªæ¥æ‰©å±•

### å¯ä»¥æ·»åŠ çš„åŠŸèƒ½:

1. **æ›´å¤šå·¥å…·ç±»åˆ«**
   - Database Tools (SQL æŸ¥è¯¢)
   - API Tools (HTTP è¯·æ±‚)
   - Cloud Tools (AWS, Azure, GCP)

2. **å¢å¼ºå®‰å…¨æ€§**
   - Docker å®¹å™¨éš”ç¦»
   - èµ„æºé…é¢é™åˆ¶
   - æ‰§è¡Œè¶…æ—¶æ§åˆ¶
   - ä»£ç é™æ€åˆ†æ

3. **æ€§èƒ½ä¼˜åŒ–**
   - ä»£ç ç¼“å­˜
   - å¹¶å‘æ‰§è¡Œ
   - ç»“æœç¼“å­˜

4. **ç›‘æ§å’Œå¯è§‚æµ‹æ€§**
   - æ‰§è¡Œæ—¥å¿—
   - æ€§èƒ½æŒ‡æ ‡
   - é”™è¯¯è¿½è¸ª

## ğŸ“š å‚è€ƒèµ„æº

- [Anthropic åŸæ–‡](https://www.anthropic.com/engineering/code-execution-with-mcp)
- [MCP å®˜æ–¹æ–‡æ¡£](https://modelcontextprotocol.io/)
- [MCP SDK](https://modelcontextprotocol.io/docs/sdk)

## ğŸ‰ æ€»ç»“

è¿™ä¸ªé¡¹ç›®æˆåŠŸå®ç°äº† Anthropic æ–‡ç« ä¸­æå‡ºçš„**ä»£ç æ‰§è¡Œæ¨¡å¼**,è¯æ˜äº†è¿™ç§æ–¹æ³•å¯ä»¥:

1. **å¤§å¹…é™ä½ Token ä½¿ç”¨** (95%+ èŠ‚çœ)
2. **æ˜¾è‘—æé«˜å“åº”é€Ÿåº¦** (66-98% æ”¹å–„)
3. **é™ä½è¿è¥æˆæœ¬** (97.5% èŠ‚çœ)
4. **å¢å¼ºéšç§ä¿æŠ¤** (PII ä¸è¿›ä¸Šä¸‹æ–‡)
5. **æ”¯æŒæŠ€èƒ½ç§¯ç´¯** (å¯å¤ç”¨å‡½æ•°åº“)

è¿™å°±æ˜¯ **Agent ä¸å·¥å…·äº¤äº’çš„æœªæ¥æ–¹å¼**! ğŸš€

---

**é¡¹ç›®çŠ¶æ€**: âœ… å®Œæˆ
**ä»£ç è¡Œæ•°**: ~700 è¡Œ Python
**æ–‡æ¡£å­—æ•°**: ~15,000 å­—
**ç¤ºä¾‹æ•°é‡**: 6 ä¸ªè¯¦ç»†åœºæ™¯
**æ€§èƒ½æå‡**: 95-99% token èŠ‚çœ

**åˆ›å»ºæ—¥æœŸ**: 2025-11-14
**ç‰ˆæœ¬**: 1.0.0
